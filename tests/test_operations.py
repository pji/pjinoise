"""
test_operations
~~~~~~~~~~~~~~~

Unit tests for the pjinoise.operations module.
"""
import unittest as ut
from typing import Callable, List

import numpy as np

from pjinoise import operations as op


# Utility functions.
def run_test(operation:Callable) -> List[int]:
    a = np.array([
        [0x00, 0x40, 0x80, 0xc0, 0xff,],
        [0x00, 0x40, 0x80, 0xc0, 0xff,],
        [0x00, 0x40, 0x80, 0xc0, 0xff,],
        [0x00, 0x40, 0x80, 0xc0, 0xff,],
        [0x00, 0x40, 0x80, 0xc0, 0xff,],
    ])
    b = np.array([
        [0xff, 0xc0, 0x80, 0x40, 0x00,],
        [0xff, 0xc0, 0x80, 0x40, 0x00,],
        [0xff, 0xc0, 0x80, 0x40, 0x00,],
        [0xff, 0xc0, 0x80, 0x40, 0x00,],
        [0xff, 0xc0, 0x80, 0x40, 0x00,],
    ])
    result = operation(a, b)
    result = np.around(result).astype(int)
    return result.tolist()


# Test classes.
class OperationsTestCase(ut.TestCase):
    def test_difference(self):
        """Given two arrays, operations.difference should return the 
        absolute value of the difference between each point in the 
        arrays.
        """
        exp = [
            [0xff, 0x80, 0x00, 0x80, 0xff,],
            [0xff, 0x80, 0x00, 0x80, 0xff,],
            [0xff, 0x80, 0x00, 0x80, 0xff,],
            [0xff, 0x80, 0x00, 0x80, 0xff,],
            [0xff, 0x80, 0x00, 0x80, 0xff,],
        ]
        act = run_test(op.difference)
        self.assertListEqual(exp, act)